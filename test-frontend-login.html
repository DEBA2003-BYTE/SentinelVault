<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Frontend Login</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        .result {
            background: white;
            padding: 15px;
            margin-top: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .success { border-left: 4px solid #4CAF50; }
        .error { border-left: 4px solid #f44336; }
        .info { border-left: 4px solid #2196F3; }
    </style>
</head>
<body>
    <h1>ðŸ§ª SentinelVault Frontend Login Test</h1>
    
    <div class="test-section">
        <h2>Test 1: Simple Login (No Device Info)</h2>
        <button onclick="testSimpleLogin()">Test Simple Login</button>
        <div id="simple-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Login with Device Context</h2>
        <button onclick="testDeviceLogin()">Test Device Login</button>
        <div id="device-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Check Device Context Generation</h2>
        <button onclick="testDeviceContext()">Generate Device Context</button>
        <div id="context-result" class="result"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000';

        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.textContent = JSON.stringify(data, null, 2);
            element.className = 'result ' + (isError ? 'error' : 'success');
        }

        async function testSimpleLogin() {
            const resultDiv = document.getElementById('simple-result');
            resultDiv.textContent = 'Testing...';
            resultDiv.className = 'result info';

            try {
                const response = await fetch(`${API_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'admin@gmail.com',
                        password: 'Debarghya'
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    showResult('simple-result', {
                        status: 'SUCCESS âœ…',
                        statusCode: response.status,
                        message: data.message,
                        hasToken: !!data.token,
                        user: data.user
                    });
                } else {
                    showResult('simple-result', {
                        status: 'FAILED âŒ',
                        statusCode: response.status,
                        error: data
                    }, true);
                }
            } catch (error) {
                showResult('simple-result', {
                    status: 'ERROR âŒ',
                    error: error.message
                }, true);
            }
        }

        function generateDeviceFingerprint() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            if (ctx) {
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.fillText('Device fingerprint', 2, 2);
            }
            const canvasFingerprint = canvas.toDataURL();

            const fingerprintData = {
                canvas: canvasFingerprint.slice(-50),
                screen: {
                    width: window.screen.width,
                    height: window.screen.height,
                    colorDepth: window.screen.colorDepth
                },
                navigator: {
                    userAgent: window.navigator.userAgent,
                    language: window.navigator.language,
                    platform: window.navigator.platform
                },
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                timestamp: Date.now()
            };

            const fingerprint = btoa(JSON.stringify(fingerprintData))
                .replace(/[^a-zA-Z0-9]/g, '')
                .slice(0, 32);

            return fingerprint;
        }

        async function testDeviceContext() {
            const resultDiv = document.getElementById('context-result');
            resultDiv.textContent = 'Generating...';
            resultDiv.className = 'result info';

            try {
                const fingerprint = generateDeviceFingerprint();
                
                const context = {
                    fingerprint: fingerprint,
                    location: 'Test Location',
                    userAgent: navigator.userAgent,
                    timestamp: new Date().toISOString(),
                    clientInfo: {
                        screenResolution: `${screen.width}x${screen.height}`,
                        colorDepth: screen.colorDepth,
                        pixelRatio: window.devicePixelRatio,
                        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                        platform: navigator.platform,
                        language: navigator.language,
                        cookieEnabled: navigator.cookieEnabled,
                        doNotTrack: navigator.doNotTrack || 'unspecified'
                    }
                };

                showResult('context-result', {
                    status: 'GENERATED âœ…',
                    context: context
                });
            } catch (error) {
                showResult('context-result', {
                    status: 'ERROR âŒ',
                    error: error.message
                }, true);
            }
        }

        async function testDeviceLogin() {
            const resultDiv = document.getElementById('device-result');
            resultDiv.textContent = 'Testing...';
            resultDiv.className = 'result info';

            try {
                const fingerprint = generateDeviceFingerprint();
                
                const payload = {
                    email: 'admin@gmail.com',
                    password: 'Debarghya',
                    deviceFingerprint: fingerprint,
                    location: 'Test Location',
                    clientInfo: {
                        screenResolution: `${screen.width}x${screen.height}`,
                        colorDepth: screen.colorDepth,
                        pixelRatio: window.devicePixelRatio,
                        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                        platform: navigator.platform,
                        language: navigator.language,
                        cookieEnabled: navigator.cookieEnabled,
                        doNotTrack: navigator.doNotTrack || 'unspecified'
                    }
                };

                console.log('Sending payload:', payload);

                const response = await fetch(`${API_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                
                if (response.ok) {
                    showResult('device-result', {
                        status: 'SUCCESS âœ…',
                        statusCode: response.status,
                        message: data.message,
                        hasToken: !!data.token,
                        user: data.user,
                        deviceInfo: data.deviceInfo
                    });
                } else {
                    showResult('device-result', {
                        status: 'FAILED âŒ',
                        statusCode: response.status,
                        error: data,
                        sentPayload: payload
                    }, true);
                }
            } catch (error) {
                showResult('device-result', {
                    status: 'ERROR âŒ',
                    error: error.message
                }, true);
            }
        }

        // Auto-run simple test on load
        window.addEventListener('load', () => {
            console.log('Test page loaded. Click buttons to run tests.');
        });
    </script>
</body>
</html>