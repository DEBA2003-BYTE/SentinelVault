
> start
> bun index.ts

NOTE: The AWS SDK for JavaScript (v2) is in maintenance mode.
 SDK releases are limited to address critical bug fixes and security issues only.

Please migrate your code to use AWS SDK for JavaScript (v3).
For more information, check the blog post at https://a.co/cUPnyil
      at emitWarning (/Users/debarghyapramanik/Desktop Backup/Sentinel Vault/backend/node_modules/aws-sdk/lib/maintenance_mode_message.js:38:13)
      at <anonymous> (/Users/debarghyapramanik/Desktop Backup/Sentinel Vault/backend/node_modules/aws-sdk/lib/maintenance_mode_message.js:46:5)

‚ö†Ô∏è  Skipping policy data load - MongoDB not connected
Attempting MongoDB connection (1/3)...
Server running on port 3001
‚úÖ Connected to MongoDB successfully
‚úÖ MongoDB ping successful
üîÑ Initializing OPA policies...
‚ö†Ô∏è  OPA initialization failed - continuing without policy enforcement
üí° To enable OPA: docker run -p 8181:8181 openpolicyagent/opa:latest run --server
Login request body: {
  email: "dd@gmail.com",
  password: "dddddddd",
  gps: {
    lat: 13.326234810352867,
    lon: 77.1285934407303,
  },
  location: {
    type: "Point",
    coordinates: [ 77.1285934407303, 13.326234810352867 ],
    name: "Login location",
  },
}
Generated device fingerprint for login: TW96aWxsYS81LjAgKE1hY2ludG9zaDsg
Using device fingerprint and location for login: {
  deviceFingerprint: "TW96aWxsYS81LjAgKE1hY2ludG9zaDsg",
  location: "Login location",
}
[RBA] User dd@gmail.com has 4 failed attempts in last hour
[RBA] Calling OPA with input: {
  "failed_count": 4,
  "gps": {
    "lat": 13.326234810352867,
    "lon": 77.1285934407303
  },
  "keystroke_sample": {},
  "timestamp": "2025-12-02T17:26:10.901Z",
  "device_id": null,
  "user": {
    "keystroke_baseline": {
      "meanIKI": 0,
      "stdIKI": 0,
      "samples": 0
    },
    "location_history": [],
    "known_devices": [],
    "activity_hours": {
      "start": 8,
      "end": 20,
      "tz": "Asia/Kolkata"
    },
    "last_login_details": {
      "gps": {}
    }
  }
}
[RBA] OPA error, using fallback scoring: warn: Unable to connect. Is the computer able to access the url?
  path: "http://localhost:8181/v1/data/rba_scoring",
 errno: 0,
  code: "ConnectionRefused"


[RBA] Fallback scoring result: {
  riskScore: 62,
  breakdown: {
    failedAttempts: 40,
    gps: 12,
    typing: 2,
    timeOfDay: 8,
    velocity: 0,
    newDevice: 0,
    otherTotal: 22,
  },
}
üîê === MFA VERIFICATION STARTED ===
Request body: {
  "userId": "692f1fd7f982ed59fe00888b",
  "deviceFingerprint": "TW96aWxsYS81LjAgKE1hY2ludG9zaDsg",
  "biometricVerified": true,
  "credentialId": "bv5yDstY713wlJrSf9iTFGH9BVU",
  "location": {
    "type": "Point",
    "coordinates": [
      77.1285934407303,
      13.326234810352867
    ],
    "name": "MFA verification location"
  }
}
üîê MFA Verification Request: {
  userId: "692f1fd7f982ed59fe00888b",
  biometricVerified: true,
  hasCredentialId: true,
  hasLocation: true,
}
üë§ User found: dd@gmail.com
‚úÖ Biometric MFA successful for user: dd@gmail.com
   Credential ID: bv5yDstY713wlJrSf9iTFGH9BVU
   Device verified biometric - granting access
‚úÖ MFA verification complete, sending response
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
Login request body: {
  email: "dd@gmail.com",
  password: "dddddddd",
  gps: {
    lat: 13.326227649522373,
    lon: 77.12867709058584,
  },
  location: {
    type: "Point",
    coordinates: [ 77.12867709058584, 13.326227649522373 ],
    name: "Login location",
  },
}
Generated device fingerprint for login: TW96aWxsYS81LjAgKE1hY2ludG9zaDsg
Using device fingerprint and location for login: {
  deviceFingerprint: "TW96aWxsYS81LjAgKE1hY2ludG9zaDsg",
  location: "Login location",
}
[RBA] User dd@gmail.com has 4 failed attempts in last hour
[RBA] Calling OPA with input: {
  "failed_count": 4,
  "gps": {
    "lat": 13.326227649522373,
    "lon": 77.12867709058584
  },
  "keystroke_sample": {},
  "timestamp": "2025-12-02T17:26:49.600Z",
  "device_id": null,
  "user": {
    "keystroke_baseline": {
      "meanIKI": 0,
      "stdIKI": 0,
      "samples": 0
    },
    "location_history": [],
    "known_devices": [],
    "activity_hours": {
      "start": 8,
      "end": 20,
      "tz": "Asia/Kolkata"
    },
    "last_login_details": {
      "gps": {}
    }
  }
}
[RBA] OPA error, using fallback scoring: warn: Unable to connect. Is the computer able to access the url?
  path: "http://localhost:8181/v1/data/rba_scoring",
 errno: 0,
  code: "ConnectionRefused"


[RBA] Fallback scoring result: {
  riskScore: 62,
  breakdown: {
    failedAttempts: 40,
    gps: 12,
    typing: 2,
    timeOfDay: 8,
    velocity: 0,
    newDevice: 0,
    otherTotal: 22,
  },
}
üîê === MFA VERIFICATION STARTED ===
Request body: {
  "userId": "692f1fd7f982ed59fe00888b",
  "deviceFingerprint": "TW96aWxsYS81LjAgKE1hY2ludG9zaDsg",
  "biometricVerified": true,
  "credentialId": "bv5yDstY713wlJrSf9iTFGH9BVU",
  "location": {
    "type": "Point",
    "coordinates": [
      77.12867709058584,
      13.326227649522373
    ],
    "name": "MFA verification location"
  }
}
üîê MFA Verification Request: {
  userId: "692f1fd7f982ed59fe00888b",
  biometricVerified: true,
  hasCredentialId: true,
  hasLocation: true,
}
üë§ User found: dd@gmail.com
‚úÖ Biometric MFA successful for user: dd@gmail.com
   Credential ID: bv5yDstY713wlJrSf9iTFGH9BVU
   Device verified biometric - granting access
‚úÖ MFA verification complete, sending response
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
Verifying token...
Fetching user from database: {
  userId: "692f1fd7f982ed59fe00888b",
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
User authenticated successfully: {
  userId: "692f1fd7f982ed59fe00888b",
  email: "dd@gmail.com",
  isAdmin: false,
}
